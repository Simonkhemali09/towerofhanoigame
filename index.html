<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Touch & Drag Tower of Hanoi</title>
    <style>
        :root {
            --bg: #0f172a;
            --peg: #475569;
            --accent: #38bdf8;
            --text: #f8fafc;
        }

        * { box-sizing: border-box; touch-action: none; } /* Critical for mobile dragging */

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        .stats { margin: 20px 0; font-size: 1.2rem; display: flex; gap: 20px; }

        .game-area {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            width: 100%;
            max-width: 600px;
            height: 300px;
            position: relative;
            margin-top: 50px;
            border-bottom: 8px solid var(--peg);
        }

        .peg {
            width: 30%;
            height: 100%;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            position: relative;
        }

        .peg::after {
            content: '';
            position: absolute;
            bottom: 0;
            width: 12px;
            height: 90%;
            background: var(--peg);
            border-radius: 10px 10px 0 0;
            z-index: 1;
        }

        .disk {
            height: 35px;
            border-radius: 10px;
            position: absolute; /* Needed for free dragging */
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            transition: background 0.3s;
            cursor: grab;
        }

        .disk.dragging {
            cursor: grabbing;
            z-index: 100;
            transition: none; /* Smooth movement during drag */
        }

        .controls { margin-top: 50px; }
        button {
            padding: 12px 24px;
            background: var(--accent);
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }

        #win-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
    </style>
</head>
<body>

    <div class="stats">
        <span>Moves: <span id="moves">0</span></span>
        <span>Time: <span id="time">00:00</span></span>
    </div>

    <div class="game-area" id="game-area">
        <div class="peg" data-index="0"></div>
        <div class="peg" data-index="1"></div>
        <div class="peg" data-index="2"></div>
    </div>

    <div class="controls">
        <button onclick="resetGame()">Reset Game</button>
    </div>

    <div id="win-modal">
        <h1 style="color: var(--accent)">VICTORY!</h1>
        <p id="win-text"></p>
        <button onclick="resetGame()">Play Again</button>
    </div>

    <script>
        const gameArea = document.getElementById('game-area');
        const pegs = document.querySelectorAll('.peg');
        const colors = ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6'];
        
        let moveCount = 0;
        let activeDisk = null;
        let startPeg = null;
        let diskOffset = { x: 0, y: 0 };
        let diskStacks = [[], [], []];
        let timer = null;
        let seconds = 0;

        function init() {
            moveCount = 0;
            seconds = 0;
            diskStacks = [[], [], []];
            document.getElementById('moves').innerText = '0';
            document.getElementById('win-modal').style.display = 'none';
            pegs.forEach(p => p.innerHTML = '');
            
            const numDisks = 4;
            for (let i = numDisks; i > 0; i--) {
                const disk = document.createElement('div');
                disk.className = 'disk';
                disk.dataset.size = i;
                disk.style.width = (50 + (i * 20)) + 'px';
                disk.style.backgroundColor = colors[i - 1];
                disk.innerText = i;
                
                // Add event listeners for both Mouse and Touch
                disk.onmousedown = dragStart;
                disk.ontouchstart = dragStart;
                
                diskStacks[0].push(disk);
            }
            renderDisks();
            startTimer();
        }

        function renderDisks() {
            diskStacks.forEach((stack, pegIndex) => {
                stack.forEach((disk, diskIndex) => {
                    if (disk !== activeDisk) {
                        pegs[pegIndex].appendChild(disk);
                        disk.style.position = 'relative';
                        disk.style.left = '0';
                        disk.style.top = '0';
                    }
                });
            });
        }

        function dragStart(e) {
            const disk = e.target;
            const peg = disk.parentElement;
            const pegIndex = parseInt(peg.dataset.index);

            // Only allow dragging the top disk
            if (diskStacks[pegIndex][diskStacks[pegIndex].length - 1] !== disk) return;

            activeDisk = disk;
            startPeg = pegIndex;
            
            const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
            const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;

            const rect = disk.getBoundingClientRect();
            diskOffset.x = clientX - rect.left;
            diskOffset.y = clientY - rect.top;

            disk.classList.add('dragging');
            disk.style.position = 'fixed';
            disk.style.width = rect.width + 'px';
            moveAt(clientX, clientY);

            document.onmousemove = dragMove;
            document.ontouchmove = dragMove;
            document.onmouseup = dragEnd;
            document.ontouchend = dragEnd;
        }

        function moveAt(clientX, clientY) {
            activeDisk.style.left = (clientX - diskOffset.x) + 'px';
            activeDisk.style.top = (clientY - diskOffset.y) + 'px';
        }

        function dragMove(e) {
            const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
            const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
            moveAt(clientX, clientY);
        }

        function dragEnd(e) {
            document.onmousemove = null;
            document.ontouchmove = null;
            
            const clientX = e.type === 'touchend' ? e.changedTouches[0].clientX : e.clientX;
            const clientY = e.type === 'touchend' ? e.changedTouches[0].clientY : e.clientY;

            activeDisk.hidden = true;
            const elemBelow = document.elementFromPoint(clientX, clientY);
            activeDisk.hidden = false;

            const targetPegElem = elemBelow ? elemBelow.closest('.peg') : null;
            const targetPegIndex = targetPegElem ? parseInt(targetPegElem.dataset.index) : null;

            if (targetPegIndex !== null && isValidMove(activeDisk, targetPegIndex)) {
                diskStacks[startPeg].pop();
                diskStacks[targetPegIndex].push(activeDisk);
                if (startPeg !== targetPegIndex) {
                    moveCount++;
                    document.getElementById('moves').innerText = moveCount;
                }
            }

            activeDisk.classList.remove('dragging');
            activeDisk = null;
            renderDisks();
            checkWin();
        }

        function isValidMove(disk, targetIdx) {
            const stack = diskStacks[targetIdx];
            if (stack.length === 0) return true;
            return parseInt(disk.dataset.size) < parseInt(stack[stack.length - 1].dataset.size);
        }

        function startTimer() {
            if(timer) clearInterval(timer);
            timer = setInterval(() => {
                seconds++;
                const m = Math.floor(seconds/60).toString().padStart(2, '0');
                const s = (seconds%60).toString().padStart(2, '0');
                document.getElementById('time').innerText = `${m}:${s}`;
            }, 1000);
        }

        function checkWin() {
            if (diskStacks[2].length === 4) {
                clearInterval(timer);
                document.getElementById('win-modal').style.display = 'flex';
                document.getElementById('win-text').innerText = `Finished in ${moveCount} moves!`;
            }
        }

        function resetGame() { init(); }

        init();
    </script>
</body>
</html>